# xuebeng_how_to_resolve
服务器雪崩如何处理
（https://mp.weixin.qq.com/s/5onXlOW4fN5qDQSfPf3Osg）
雪崩、脑裂，都是无可避免的。

雪崩如何产生的：

linux + nginx + PHP 

服务A(两个IDC) 依赖于 服务B(两个IDC)  ；用户请求失败会重试；用户调用A.


服务B 全挂了==》 导致 A 服务调用超时，则nginx 重试 A的另一个IDC  又超时 ===》 nginx 返回客户端 超时==》 客户端重试==
===》重复上述步骤 ==》 优于A超时，但是没有释放进程 ==》 最终导致A 服务所在 PHP进程池  ==》 被耗尽。===》 依赖的A服务的其他 服务===》超时==
==》如此循环 ===》整站 崩溃。
（A服务，还有其他功能不依赖B服务）

解决之法===》 接口与服务之间 ===》 加入一层===》保护 过载保护？？？ 应该是类似吧。

雪崩如何处理：  需要具体解释  

限流：
失败次数达到阈值，拒绝访问。（这解释的太笼统）
===》 应该是 某一个 接口的失败次数超过 阈值===》 拒绝此接口访问。（其他接口不应该拒绝）==》 或者说 叫 接口限流。
（nginx 分发的下一层 做这个处理？）


服务隔离：  
不同类型接口隔离部署===》 不同的docker内？？？==》避免主机 进程被耗尽
不同类型？？？  在拆分服务？？？

此类型接口，如果挂了，因为已经隔离，即使PHP进程耗尽，也对其他接口毫无影响。

隔离的含义，还是不太明白。


溶断：  
“从接口请求连接就拒绝访问”===》从nginx 层处理？？？

降级：  
如果有失败，返回默认值。====》 如果服务器负载较高===》 把其他非核心服务停止==》 把更多的资源（进程、内存、网络、存储等） 供给给这个服务使用。

java 的Hystrix是什么？

Hystrix是一个通过增加延迟容错和容错逻辑来控制分布式服务之间交互的一个库。Hystrix通过线程隔离，防止错误级联传递，导致服务雪崩，从而提高服务稳定性。



java 确实 成熟，各种 配件都有。Hystrix 应该是做的比较好。

PHP 我谷歌了一下，不多。
https://yuerblog.cc/2017/12/08/microservice-circuit-breaker/

lstio 也有此功能
https://istio.io/zh/docs/tasks/traffic-management/circuit-breaking/

